---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "courier_deployment Resource - terraform-provider-courier"
subcategory: ""
description: |-
  Specify how to deploy.
---

# courier_deployment (Resource)

Specify how to deploy.

## Example Usage

```terraform
variable "deployment_strategy" {
  type        = string
  description = "The deployment strategy to use, either `recreate` or `rolling`."
  default     = "recreate"

  validation {
    condition     = contains(["recreate", "rolling"], var.deployment_strategy)
    error_message = "Invalid deployment strategy, must be one of `recreate` or `rolling`."
  }
}

variable "deployment_strategy_rolling_max_surge" {
  type        = number
  description = "The maximum percent of targets to deploy at once during rolling."
  default     = 0.3

  validation {
    condition     = var.deployment_strategy_rolling_max_surge >= 0.1 && var.deployment_strategy_rolling_max_surge <= 1
    error_message = "Invalid deployment rolling maximum surge, must be between 0.1 and 1.0."
  }
}

variable "deployment_progress_timeout" {
  type        = string
  description = "The timeout for deployment progress."
  default     = "5m"
}

resource "courier_deployment" "example" {
  targets = [
    {
      host = {
        address = "..."
        authn   = {
          type   = "..."
          user   = "..."
          secret = "..."
        }
      }
    }
  ]

  runtime = {
    class = "..."
  }

  artifact = {
    refer = {
      uri = "..."
    }
    runtime = "..."
  }

  strategy = {
    type    = var.deployment_strategy
    rolling = var.deployment_strategy == "rolling" ? {
      max_surge = var.deployment_strategy_rolling_max_surge
    } : null
  }

  timeouts = {
    create = var.deployment_progress_timeout
    update = var.deployment_progress_timeout
    delete = var.deployment_progress_timeout
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `artifact` (Attributes) The artifact of the deployment. (see [below for nested schema](#nestedatt--artifact))
- `runtime` (Attributes) The runtime of the deployment. (see [below for nested schema](#nestedatt--runtime))
- `targets` (Attributes List) The targets of the deployment. (see [below for nested schema](#nestedatt--targets))

### Optional

- `strategy` (Attributes) Specify the strategy of the deployment. (see [below for nested schema](#nestedatt--strategy))
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))

### Read-Only

- `id` (String) The ID of the deployment.

<a id="nestedatt--artifact"></a>
### Nested Schema for `artifact`

Required:

- `refer` (Attributes) The reference of the artifact. (see [below for nested schema](#nestedatt--artifact--refer))

Optional:

- `command` (String) The command to start the artifact.
- `digest` (String) The digest of the artifact, in form of algorithm:checksum.
- `envs` (Map of String) The environment variables of the artifact.
- `ports` (List of Number) The ports of the artifact.
- `volumes` (List of String) The volumes of the artifact.

<a id="nestedatt--artifact--refer"></a>
### Nested Schema for `artifact.refer`

Required:

- `uri` (String) The reference to pull the artifact.

Optional:

- `authn` (Attributes) The authentication for pulling the artifact. (see [below for nested schema](#nestedatt--artifact--refer--authn))
- `insecure` (Boolean) Specify to pull the artifact with insecure mode.

<a id="nestedatt--artifact--refer--authn"></a>
### Nested Schema for `artifact.refer.authn`

Required:

- `secret` (String, Sensitive) The secret for authentication, either password or token.

Optional:

- `type` (String) The type for authentication, either "basic" or "bearer".
- `user` (String) The user for authentication.




<a id="nestedatt--runtime"></a>
### Nested Schema for `runtime`

Required:

- `class` (String) Specify the class of the runtime.

Optional:

- `authn` (Attributes) The authentication for fetching the runtime. (see [below for nested schema](#nestedatt--runtime--authn))
- `insecure` (Boolean) Specify to fetch the runtime with insecure mode.
- `source` (String) The source to fetch the runtime, 
only support a git repository at present.

  - For example:
    - https://github.com/foo/bar, clone the HEAD commit of the default branch.
    - https://github.com/foo/bar//subpath, clone the HEAD commit of the default branch, 
      and use the subdirectory.
    - https://github.com/foo/bar?ref=dev, clone the "dev" commit.
  - Comply with the following structure:
    ```
    /tomcat     	 # the name of the runtime.
      /linux         # the os supported by the runtime.
        /service.sh  # the POSIX shell script, must name as service.sh.
          setup
          start
          state
          stop
          cleanup
      /windows
        /service.ps1 # the PowerShell script, must name as service.ps1.
    ```

<a id="nestedatt--runtime--authn"></a>
### Nested Schema for `runtime.authn`

Required:

- `secret` (String, Sensitive) The secret for authentication, either password or token.

Optional:

- `type` (String) The type for authentication, either "basic" or "bearer".
- `user` (String) The user for authentication.



<a id="nestedatt--targets"></a>
### Nested Schema for `targets`

Required:

- `arch` (String) The architecture of the target.
- `host` (Attributes) Specify the target to access. (see [below for nested schema](#nestedatt--targets--host))
- `os` (String) The operating system of the target.

<a id="nestedatt--targets--host"></a>
### Nested Schema for `targets.host`

Required:

- `address` (String) The address to access the target, 
in the form of [schema://](ip|dns)[:port].
- `authn` (Attributes) The authentication for accessing the host. (see [below for nested schema](#nestedatt--targets--host--authn))

Optional:

- `insecure` (Boolean) Specify to access the target with insecure mode.
- `proxies` (Attributes List) The proxies before accessing the target, 
either a bastion host or a jump host. (see [below for nested schema](#nestedatt--targets--host--proxies))

<a id="nestedatt--targets--host--authn"></a>
### Nested Schema for `targets.host.authn`

Optional:

- `agent` (Boolean) Specify to access the target with agent,
either SSH agent if type is "ssh" or NTLM if type is "winrm".
- `secret` (String, Sensitive) The secret to authenticate when accessing the target, 
either password or private key.
- `type` (String) The type to access the target, either "ssh" or "winrm".
- `user` (String) The user to authenticate when accessing the target.


<a id="nestedatt--targets--host--proxies"></a>
### Nested Schema for `targets.host.proxies`

Required:

- `address` (String) The address to access the proxy, 
in the form of [schema://](ip|dns)[:port].
- `authn` (Attributes) The authentication for accessing the proxy. (see [below for nested schema](#nestedatt--targets--host--proxies--authn))

Optional:

- `insecure` (Boolean) Specify to access the target with insecure mode.

<a id="nestedatt--targets--host--proxies--authn"></a>
### Nested Schema for `targets.host.proxies.insecure`

Optional:

- `secret` (String, Sensitive) The secret to authenticate 
when accessing the proxy, either password or private key.
- `type` (String) The type to access the proxy, 
either "ssh" or "proxy".
- `user` (String) The user to authenticate 
when accessing the proxy.





<a id="nestedatt--strategy"></a>
### Nested Schema for `strategy`

Optional:

- `rolling` (Attributes) The rolling strategy of the deployment. (see [below for nested schema](#nestedatt--strategy--rolling))
- `type` (String) The type of the deployment strategy,
either "recreate" or "rolling".

<a id="nestedatt--strategy--rolling"></a>
### Nested Schema for `strategy.rolling`

Optional:

- `max_surge` (Number) The maximum percent of targets to deploy at once.



<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
- `delete` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs.
- `update` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).


